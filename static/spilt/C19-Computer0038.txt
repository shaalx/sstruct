	计算机	应用	Computer	Applications1999	年	第19	卷	第7	期	Vol.19	No.7	1999	地理	示意图	排版	软件	的	面向	对象	分析	伍　江		魏子乐		摘		要		本文	讨论	了	一个	地理	示意图	排版	软件	的	主要	结构	和	思想	该	软件	采用	面向	对象	的	方法	进行	分析	设计	和	实现	本文	具体	阐述	了	所	采用	的	面向	对象	方法	并	在	一些	较	难	实现	的	功能	上	提出	了	创新	的	解决	方法		关键词		面向	对象	OOA	属性	服务	连接	地理	示意图		THE	OBJECT-ORIENTED	ANALYSISOF	MAP-PUBLISHING	SOFTWAREWu	Jiang		Wei	ZileNational	Key	Laboratory	of	Text	当	排版	人员	需要	在	报纸	或	杂志	的	版面	上	插入	一个	示意图	以	表示	某个	地方	的	相对	位置	以及	该	地方	的	街区	概貌	时	通常	使用	Illustrator	CorelDraw	FreeHand	等	通用	绘图	软件	来	完成	但	这些	绘图	软件	由于	其	固有	的	通用性	满足	不	了	地理	示意图	的	一些	特定	要求	例如	方便	地	绘制	各种	类型	的	道路	铁路	河流	灵活	设定	不同	道路	之间	的	交叉	覆盖	和	焊接	灵活	地	设定	文字	的	方向	和	位置	等等	这些	都	是	通用	绘图	软件	所	不	具备	的	功能		我们	开发	的	地理	示意图	软件	是	专门	针对	各类	对	坐标	位置	要求	不	是	很	精确	的	地理	示意图	的	排版	而	设计	的	在	需求	上	考虑	了	地理	示意图	版式	和	操作	两	方面	的	特点	因此	既	不同	于	精确度	很	高	的	专业	地图	绘制	系统	也	不同	于	通用	的	绘图	软件	在	整个	开发	过程	中	我们	采用	了	面向	对象	的	分析	方法	以下	是	一个	示意图	的	例子	图1	和	一般	的	图形	软件	相比	示意图	软件	必须	具有	如下	特殊	功能		能	方便	地	绘制	各种	风格	的	道路	铁路	河流	等	通用	图形	对象		能	方便	地	在	道路	河流	交叉	的	地方	画桥		能	方便	地	设定	不同	道路	铁路	之间	在	交叉点处	的	相互	覆盖	关系	甚至	能够	实现	两	条	道路	首尾	互相	覆盖		能	方便	地	将	多	条	道路	焊接	在	一起	构成	连通	的	道路		提供	用于	绘制	示意图	的	基本	图例	且	图例	的	参数	可	由	用户	调节		能	方便	地	将	一	串	文字	安排	到	路	中间	或	旁边	以及	与	路	平行	的	方向	还	能	设定	文字	的	指示线	使	其	固定	指向	某个	位置	3		面向	对象	的	需求	分析	3.1		指导	思想	和	原理		从	上面	的	需求	可以	看出	地理	示意图	软件	是	一	种	具有	强烈	对象化	特征	的	软件	因而	较	适合	采用	面向	对象	的	方法	进行	分析	设计	和	实现	即	运用	对象	类	继承	封装	聚合	消息	传送	多态性	等	概念	来	构造	该	系统	2	3.2		发现	对象	建立	对象	类	如	图	1	所	示	示意图	主要	由	一些	道路	建筑物	和	各种	标志	及	文字	组成	因此	系统	中	的	对象	可以	是		示意图	对象		表示	整个	要	被	排版	的	地理	示意图	对	地理	示意图	进行	的	各种	操作	都	首先	通过	该	对象	进行	后文	的	所有	对象	和	示意图	对象	的	关系	均	是	整体	部分	关系	它们	被	示意图	对象	所	包含		道路	对象		表示	地理	示意图	中	的	各种	道路	它	又	可	派生	出	以下	几	种	道路	对象	带	边界	路	黑	白	相间	路	无	边界路	河流	带	边界路	的	特点	是	在	一	条	具有	给	定宽度	和	颜色	的	线	两侧	再	附	加上	给	定宽度	和	颜色	的	边界	黑白	相间	路	是	指	沿着	线	的	走向	黑线段	和	白线	段	相互	间隔	的	路	无	边界路	只	是	一	条	具有	给	定宽度	和	颜色	的	线	河流	则	是	在	带	边界路	的	基础	上	再	将	两	条	边	之间	的	部分	铺	以	适当	的	波纹	带	边界	路	黑	白	相间	路	无	边界路	河流	分别	构成	四	类	独立	的	对象	它们	和	道路	对象	之间	是	一般	特殊	关系		标志物	对象		地理	示意图	中	的	各种	特殊	标志	标志物	对象	也	需要	派生	出	大量	具体	的	对象	如	电话亭	路标	公共	汽车站	加油站	等	每	种	对象	均	可	由	用户	设定	其	特定	的	参数		文字	对象		示意图	上	的	文字	描述	可以	包含	边框	可以	有	附加	的	指示	线	指向	相应	的	对象		扩充	图形	对象		这	是	一	类	没有	固定	物理	意义	的	对象	它	具有	较	强	的	形状	描述	能力	能够	描述	各种	比较	复杂	的	几何	形状	包括	圆	矩形	曲线	或	直线	多边形	以及	由	这些	形状	合并	而	成	的	复杂	形状	扩充	图形	对象	类似	于	通用	绘图	软件	中	的	图元	对象	用于	描述	地理	示意图	中	除去	以上	对象	之外	的	其它	各类	有形	对象	这	类	对象	依赖	于	相应	的	道路	或	河流	而	存在	但	又	有	一定	的	独立性	因而	自	成	一	类	称为	依赖	对象	从	依赖	对象	派生	出	覆盖	对象	焊接	对象	桥	对象	从而	具体	实现	道路	和	道路	之间	交叉点处	的	覆盖	焊接	和	桥	依赖	对象	和	前述	的	道路	对象	之间	具有	实例	连接	和	消息	连接	两	种	联系	下图	是	这	三类	依赖	对象	的	具体	实例	图	23.3		定义	属性	和	服务		限于	篇幅	表	1	只	列出	各	对象	的	一些	主要	属性	和	服务	表	1	对象	名称	属性	服务	示意图	对象	示意图	上	所有	对象	从	2	到	6	的	对象	的	列表	示意图	的	边框	和	底色	示意图	大小	对象	检索	服务	列举	出示	意图	中	的	所有	对象	或	某	一	类	对象	添加	一个	新	的	对象	到	示意图	中	删除	示意图	中	的	对象	调整	对象	在	示意图	中	的	顺序	输出	整个	示意图	到	屏幕	或	eps	文件	道路	对象	四	种	具体	道路	对象	的	属性	和	服务	从略	道路	的	骨架线	取	道路	的	骨架线	取	道路	的	轮廓	输出	道路	到	屏幕	或	eps	文件	标志物	对象	每	一个	具体	的	标志物	对象	的	属性	和	服务	从略	标志物	的	位置	输出	志物	到	屏幕	或	eps	文件	文字	对象	文字串	输出	文字	到	屏幕	或	eps	文件	扩充	图形	对象	扩充	图形	的	位置	扩充	图形	的	形状	参数	输出	扩充	图形	到	屏幕	或	eps	文件	依赖	对象	此	对象	所	依赖	的	其他	对象	的	标识	此	对象	的	轮廓	和	位置	设置	此	对象	所	依赖	的	对象	获取	此	对象	所	依赖	的	对象	输出	依赖	对象	到	屏幕	或	eps	文件	覆盖	对象	继承	依赖	对象	的	全部	属性	两	个	有	覆盖	关系	的	对象	的	上下	顺序	交换所	依赖	对象	的	上下	覆盖	关系	输出	覆盖	对象	到	屏幕	或	eps	文件	焊接	对象	继承	依赖	对象	的	全部	属性	没有	特别	的	属性	输出	焊接	对象	到	屏幕	或	eps	文件	桥	对象	继承	依赖	对象	的	全部	属性	两	个	具有	桥	关系	的	对象	的	上下	顺序	桥	的	具体	参数	交换所	依赖	对象	的	上下	关系	修改桥	的	参数	输出桥	对象	到	屏幕	或	eps	文件	4		定义	结构	和	连接	4.1		整体	部分	结构		示意图	对象	包含	了	所有	其他	对象	它	和	其他	对象	的	关系	是	整体	部分	结构	用	面向	对象	的	分析图	表示	出来	就是		4.2		一般	特殊	结构		道路	对象	和	带	边界	路	黑	白	相间	路	无	边界路	河流	的	关系	是	一般	特殊	结构	后	四	种	路	继承	道路	对象	的	属性	和	服务	并重	载	其中	的	取	道路	的	轮廓	和	输出	道路	到	屏幕	或	eps	文件	两	项	服务			另外	依赖	对象	和	覆盖	对象	焊接	对象	桥	对象	的	关系	也	是	一般	特殊	结构	后	三	者	重载	依赖	对象	的	输出	依赖	对象	到	屏幕	或	eps	文件	服务	图略	4.3		实例	连接		A	覆盖	对象		在	各个	依赖	对象	和	道路	对象	之间	存在	着	实例	连接	的	关系	这	是	因为	每	一个	依赖	对象	都	是	为	某些	道路	对象	提供	服务	的	例如	两	条	道路	发生	了	一个	交叉	则	在	交叉点处	形成	一个	覆盖	对象	该	覆盖	对象	依赖	且	只	依赖	于	这	两	条	道路	而	这	两	条	道路	则	通过	这个	覆盖	对象	来	实现	它们	在	交叉点处	时	谁	在	上面	谁	在	下面		具体	的	实现	机理	是	首先	根据	两	条	道路	的	骨架线	计算	出	它们	的	交叉点	然后	再	根据	它们	各自	的	宽度	算	出	它们	在	该	交叉点处	的	重叠区	该	重叠区	即	是	覆盖	对象	的	轮廓	若	想	实现	道路	A	在	该	交叉点	处盖	住	道路	B	只	需	在	画	完	道路	A	和	道路	B	时	再	画	覆盖	对象	而	覆盖	对象	的	画函数	则	是	去	调用	道路	A	的	画函数	再	重	画	一	次	画	的	时候	设置	覆盖	对象	的	轮廓	即	道路	A	和	道路	B	在	该处	的	重叠区	作为	裁剪区	这样	就	实现	了	道路	A	在	该	交叉点	处盖	住	了	道路	B	反之	若	想	实现	道路	B	在	该	交叉点	处盖	住	道路	A	只	须	让	覆盖	对象	调用	道路	B	的	画函数	进行	重画	由于	设置	了	裁剪区	因此	当	覆盖	对象	重	画	A	时	不	会	使	一些	本来	应该	盖	住	A	的	对象	反过来	又	被	A	盖	住	了		这样	实现	覆盖	效果	的	好处	是	无论	在	交叉点处	要	实现	谁	覆盖	谁	都	不	需要	移动	两	条	道路	的	上下	关系	从而	能	保证	这	两	条	道路	和	其他	对象	之间	的	上下	关系	不	变	更进一步	若	两	条	道路	有	两	个	交叉点	通过	分别	建立	两	个	覆盖	对象	还	能	实现	它们	在	不同	的	交叉点处	具有	相反	的	上下	关系	例如	A	的	头盖	住	B	的	尾	B	的	头	又	盖	住	A	的	尾	这	在	高	要求	的	地理	示意图	中	是	很	可能	出现	的	而	一般	的	绘图	软件	要	做到	这	点	会	很	困难		这种	方法	的	一个	主要	要求	是	覆盖	对象	必须	在	道路	A	和	道路	B	画	完	之后	再	画	这	也	是	它们	之间	的	静态	联系	之一		B	桥	对象	桥	对象	和	覆盖	对象	非常	类似	它们	的	主要	不同	在于	画	覆盖	对象	时	只是	简单	地	调用	道路	的	画函数	进行	重画	而	桥	对象	的	画函数	稍微	有	点	复杂	首先	将	桥	本身	的	形状	底纹	等	画	好	再	调	道路	A	的	画函数	从而	实现	道路	A	首先	架	在	桥	上	桥	再	盖	住	道路	B	的	效果	另外	桥	对象	的	轮廓	计算	和	覆盖	对象	的	轮廓	计算	方法	不	一样	需要	考虑	桥	本身	的	属性		C	焊接	对象		焊接	对象	是	用于	实现	将	几	条	带	边界路	的	边界	内	部分	我们	称为	路心	焊接	在	一起	对于	另外	三类	道路	无	需	考虑	焊接	由于	有	可能	多	条	道路	在	它们	的	公共	交叉点处	发生	焊接	因此	焊接	对象	要	能	同时	依赖	两	条	以上	的	道路	焊接	对象	的	实现	机理	是	当	几	条	带	边界	路	在	某个	位置	交叉	在	一起	时	由	用户	通过	鼠标	将	它们	在	交叉点处	的	重叠区	标识	出来	用	不规则	多边形	描述	该	区域	作为	要	生成	的	焊接	对象	的	轮廓	当	将	这	几	条	道路	都	画	完	后	再	通知	焊接	对象	画	出	自身	焊接	对象	的	画函数	则	轮流	调用	每	一个	被	它	依赖	的	带	边界路	的	画路心	的	函数	并	设置	焊接	对象	的	轮廓	为	裁剪区	由于	每	条	带	边界路	将	自己	的	路心	在	焊接	对象	指定	的	轮廓	内	重画	因而	确保	它们	的	路心	都	可见	也就是说	在	该	区域	内	所有	横越路心	的	边界	都	会	被	覆盖	掉	从而	实现	将	几	条	道路	的	路心	焊接	在	一起	的	效果		这种	焊接	的	好处	就	是	不	必将	被	焊接	的	多	个	对象	变成	一个	对象	因而	仍然	能	对	它们	单独	进行	操作	例如	其中	的	某	条	道路	可能	又	会	和	别的	道路	发生	复杂	的	焊接	或	覆盖	关系	这	对于	现代	城市	的	地理	示意图	来说	可能	是	一个	非常	重要	的	功能		这种	方法	的	主要	要求	是	带	边界	路	除了	提供	能	将	整个	道路	画	出来	的	服务	以外	还	应该	提供	只	画	路心	的	服务	另外	和	覆盖	对象	一样	焊接	对象	也	要	在	它	所	依赖	的	各	道路	对象	画	完	之后	才	能	画		D	示意图		以上	三	种	联系	用图	表示	出来	如下		4.4	消息	连接		在	依赖	对象	和	道路	对象	之间	还	存在	着	双向	的	消息	连接	这	主要	体现	在	两	方面	一方面	当	道路	对象	移动	或	删除	时	由于	原来	的	交叉	区域	不再	存在	或	已	改变	位置	导致	依赖	于	这	几	条	路	的	依赖	对象	也	需要	改变	位置	甚至	有	可能	不再	存在	因而	需要	删除	相应	的	依赖	对象	或	移动	依赖	对象	的	位置	另一方面	当	依赖	对象	在	画	自身	时	又	需要	调用	道路	对象	的	画函数	来	完成	任务	5		结束语		在	我们	开发	的	地理	示意图	排版	软件	中	运用	OOA	方法	使	我们	的	程序	更	易	理解	也	更	易	扩展	和	修改	由于	程序	的	结构	与	问题	的	结构	更为	接近	因而	当	问题	发生	变化	时	程序	也	更	容易	跟随	进行	修改	从而	延长	程序	的	生存	周期	降低	了	开发	成本		伍　江		博士	研究生	主要	研究	方向	文字	和	图形	的	计算机	处理		魏子乐		硕士	研究生	主要	研究	方向	文字	和	图形	的	计算机	处理		作者	单位	伍　江		魏子乐	北京大学	计算机	研究所	文字	图形	处理	国家	重点	实验室		北京	100871	参考	文献	1	汪	成为	郑小军	彭木昌	.	面向	对象	的	分析	设计	及	应用	北京	国防	工业	出版社	1992	2	邵维忠	杨芙清	.	面向	对象	的	系统	分析	北京	清华大学	出版社	广西	广西	科学技术	出版社	1998	收稿	日期	1999-03-22	的	结构	与	问题	的	结构	更为	接近	因而	当	问题	发生	变化	时	程序	也	更	容易	跟随	进行	修改	从而	延长	程序	的	生存	周期	降低	了	开发	成本	伍　江		博士	研究生	主要	研究	方向	文字	和	图形	的	计算机	处理	魏子乐	硕士	研究生	主要	研究	方向	文字	和	图形	的	计算机	处理		作者	单位	伍　江		魏子乐	北京大学	计算机	研究所	文字	图形	处理	国家	重点	实验室		北京	100871	参考	文献	1	汪	成为	郑小军	彭木昌.	面向	对象	的	分析	设计	及	应用.	北京	国防	工业	出版社	1992	2	邵维忠	杨芙	清.	面向	对象	的	系统	分析.	北京	清华大学	出版社	广西	广西	科学技术	出版社	1998	收稿	日期	1999-03-22	